<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All to PDF Converter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hero-section { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; padding: 60px 0; margin-bottom: 40px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); }
        .nav-pills .nav-link { border-radius: 10px; padding: 12px 25px; font-weight: 500; color: #495057; }
        .nav-pills .nav-link.active { background-color: #007bff; box-shadow: 0 4px 12px rgba(0,123,255,0.3); }
        .btn-primary { border-radius: 10px; padding: 12px 30px; font-weight: 600; background-color: #007bff; border: none; }
        .btn-primary:hover { background-color: #0069d9; }
        .drop-zone { border: 2px dashed #dee2e6; border-radius: 15px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; background: #fff; }
        .drop-zone:hover, .drop-zone.active { border-color: #007bff; background: #f0f7ff; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
    <h5 class="mt-3">Đang chuyển đổi... Vui lòng đợi</h5>
    <p class="text-muted">Việc này có thể mất vài giây tùy vào kích thước file hoặc trang web.</p>
</div>

<div class="hero-section text-center">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3"><i class="fas fa-file-pdf me-3"></i>All to PDF</h1>
        <p class="lead mb-0">Chuyển đổi Website, Hình ảnh và Tài liệu Office sang PDF chất lượng cao.</p>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="pills-url-tab" data-bs-toggle="pill" data-bs-target="#pills-url" type="button" role="tab"><i class="fas fa-globe me-2"></i>Website to PDF</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link ms-3" id="pills-file-tab" data-bs-toggle="pill" data-bs-target="#pills-file" type="button" role="tab"><i class="fas fa-file-upload me-2"></i>File to PDF</button>
                </li>
            </ul>

            <div class="tab-content" id="pills-tabContent">
                <!-- URL to PDF -->
                <div class="tab-pane fade show active" id="pills-url" role="tabpanel">
                    <div class="card p-4">
                        <form id="urlForm">
                            <div class="mb-4">
                                <label class="form-label fw-bold">Nhập địa chỉ Website (URL)</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-link text-muted"></i></span>
                                    <input type="url" class="form-control form-control-lg" name="url" placeholder="https://example.com" required>
                                </div>
                                <div class="form-text mt-2">Hỗ trợ tự động cuộn trang để tải đầy đủ hình ảnh (Lazy Loading).</div>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-magic me-2"></i>Bắt đầu chuyển đổi</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- File to PDF -->
                <div class="tab-pane fade" id="pills-file" role="tabpanel">
                    <div class="card p-4">
                        <form id="fileForm">
                            <div class="mb-4">
                                <label class="form-label fw-bold">Chọn tài liệu hoặc hình ảnh</label>
                                <div class="drop-zone" id="dropZone">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                    <h5>Kéo thả file vào đây hoặc click để chọn</h5>
                                    <p class="text-muted mb-0">Hỗ trợ: .docx, .xlsx, .pptx, .jpg, .png, .webp...</p>
                                    <input type="file" id="fileInput" name="file" class="d-none" required>
                                </div>
                                <div id="fileInfo" class="mt-3 text-center d-none">
                                    <span class="badge bg-info p-2"><i class="fas fa-file me-2"></i><span id="fileName"></span></span>
                                </div>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg"><i class="fas fa-magic me-2"></i>Bắt đầu chuyển đổi</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="mt-5 text-center text-muted">
                <p><small>&copy; 2026  PDF Converter. Được tối ưu bởi Playwright & LibreOffice.</small></p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const loading = document.getElementById('loadingOverlay');
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');

    // Handle Drop Zone
    dropZone.onclick = () => fileInput.click();
    
    fileInput.onchange = (e) => {
        if (e.target.files.length > 0) {
            fileName.innerText = e.target.files[0].name;
            fileInfo.classList.remove('d-none');
        }
    };

    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('active'); };
    dropZone.ondragleave = () => { dropZone.classList.remove('active'); };
    dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.classList.remove('active');
        if (e.dataTransfer.files.length > 0) {
            fileInput.files = e.dataTransfer.files;
            fileName.innerText = e.dataTransfer.files[0].name;
            fileInfo.classList.remove('d-none');
        }
    };

    // Handle Form Submissions
    async function handleConvert(formId, endpoint) {
        const form = document.getElementById(formId);
        form.onsubmit = async (e) => {
            e.preventDefault();
            loading.style.display = 'flex';
            
            try {
                const formData = new FormData(form);
                const response = await fetch(endpoint, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    
                    // Lấy tên file chuẩn từ header
                    const disposition = response.headers.get('content-disposition');
                    let filename = 'converted.pdf';
                    if (disposition && disposition.indexOf('filename=') !== -1) {
                        const filenameRegex = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/;
                        const matches = filenameRegex.exec(disposition);
                        if (matches != null && matches[1]) { 
                            filename = matches[1].replace(/['"]/g, '');
                        }
                    }
                    
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);
                } else {
                    let errorMsg = 'Không thể chuyển đổi';
                    try {
                        const text = await response.text();
                        try {
                            const err = JSON.parse(text);
                            errorMsg = err.detail || errorMsg;
                        } catch (e) {
                            errorMsg = text || errorMsg;
                        }
                    } catch (e) {
                        errorMsg = 'Lỗi kết nối server';
                    }
                    alert('Lỗi: ' + errorMsg);
                }
            } catch (err) {
                alert('Lỗi kết nối server: ' + err.message);
            } finally {
                loading.style.display = 'none';
            }
        };
    }

    handleConvert('urlForm', '/convert-url');
    handleConvert('fileForm', '/convert-file');
</script>

</body>
</html>
